(()=>{"use strict";var e={729:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},663:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StocksRepositoryRequest=void 0;var r,o=(r=s(167))&&r.__esModule?r:{default:r},a=s(703);t.StocksRepositoryRequest=class{constructor(){this.tokenAPI="EZ3IPW2YUAGT6T0O"}async findByRecentQuotes(e){try{return o.default.get(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${e}&apikey=${this.tokenAPI}`,{}).then((e=>e)).catch((e=>e))}catch(e){throw new a.AppError(`Message error: ${e}`)}}async findByHistoricPrices(e){try{return o.default.get(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${e}&apikey=${this.tokenAPI}`,{}).then((e=>e)).catch((e=>e))}catch(e){throw new a.AppError(`Message error: ${e}`)}}async compareStocks(e){try{let t=[];for(let s in e)await o.default.get(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${e[s]}&apikey=${this.tokenAPI}`,{}).then((e=>{t.push(e)})).catch((e=>e));return t}catch(e){return e}}async findByProjectGains(e){try{return o.default.get(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${e}&apikey=${this.tokenAPI}`,{}).then((e=>e)).catch((e=>e))}catch(e){throw new a.AppError(`Message error: ${e}`)}}}},401:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListCompareStocksController=void 0;var r=s(757),o=s(625);t.ListCompareStocksController=class{async handle(e,t){const{stock_name:s}=e.params,{stocks:a}=e.body,n=r.container.resolve(o.ListCompareStocksUseCase),i=await n.execute({stock_name:s,stocks:a});return t.json(i)}}},625:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListCompareStocksUseCase=void 0,s(236);var r,o=s(757),a=s(703),n=s(750),i=s(174),c=s(729);let l=(0,o.injectable)()((u=r=Reflect.metadata("design:type",Function)(r=Reflect.metadata("design:paramtypes",[void 0===c.IStocksRepositoryRequest?Object:c.IStocksRepositoryRequest])(r=class{constructor(e){this.stocksRepositoryRequest=e,this.messageError="Thank you for using Alpha Vantage! Our standard API call frequency is 5 calls per minute and 500 calls per day. Please visit https://www.alphavantage.co/premium/ if you would like to target a higher API call frequency."}async execute({stock_name:e,stocks:t}){t.unshift(e);const s=await this.stocksRepositoryRequest.compareStocks(t),r={},o=[];let c={};for(let e=0;e<s.length;e++){const r=s[e].data["Global Quote"];if(s[e].data.Note)throw new a.AppError(this.messageError);{if(void 0===r["01. symbol"])throw new a.AppError(`Name Invalid: ${t[e]}`);let s=r["01. symbol"],l=(0,i.convertAndParseFloat)(r["05. price"]),u=r["07. latest trading day"],p=(0,n.convertDateToUTC)(u);null!=s&&(c={name:s,lastPrice:l,pricedAt:p},o.push(c))}}if(o.length>=1)return Object.assign(r,{lastPrice:o}),r}})||r)||r,r=(0,o.inject)("StocksRepositoryRequest")(u,void 0,0)||r))||r;var u;t.ListCompareStocksUseCase=l},585:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListHistoricPricesController=void 0;var r=s(757),o=s(397);t.ListHistoricPricesController=class{async handle(e,t){const{stock_name:s}=e.params,{from:a,to:n}=e.query,i=r.container.resolve(o.ListHistoricPricesUseCase),c=await i.execute({stock_name:s,from:a,to:n});return t.json(c)}}},397:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListHistoricPricesUseCase=void 0,s(236);var r,o=s(757),a=s(703),n=s(750),i=s(174),c=s(729);let l=(0,o.injectable)()((u=r=Reflect.metadata("design:type",Function)(r=Reflect.metadata("design:paramtypes",[void 0===c.IStocksRepositoryRequest?Object:c.IStocksRepositoryRequest])(r=class{constructor(e){this.stocksRepositoryRequest=e,this.messageError="Thank you for using Alpha Vantage! Our standard API call frequency is 5 calls per minute and 500 calls per day. Please visit https://www.alphavantage.co/premium/ if you would like to target a higher API call frequency."}async execute({stock_name:e,from:t,to:s}){const r=await this.stocksRepositoryRequest.findByHistoricPrices(e,t,s),o={},c=[];let l={};if(r.data["Error Message"])throw new a.AppError("Name invalid");if(r.data.Note)throw new a.AppError(this.messageError);const u=r.data["Meta Data"],p=r.data["Time Series (Daily)"],d=Object.keys(p);let h=u["2. Symbol"],y=(0,n.convertDate)(t),v=(0,n.convertDate)(s);for(let e in d){let r=(0,n.convertDate)(d[e]);if(!p[t]||!p[s])throw new a.AppError("Date invalid");r>=y&&r<=v&&(l={opening:(0,i.convertAndParseFloat)(p[d[e]]["1. open"]),low:(0,i.convertAndParseFloat)(p[d[e]]["2. high"]),high:(0,i.convertAndParseFloat)(p[d[e]]["3. low"]),closing:(0,i.convertAndParseFloat)(p[d[e]]["4. close"]),pricedAt:(0,n.convertDateToUTC)(d[e])},c.push(l))}return Object.assign(o,{name:h,prices:c.reverse()}),o}})||r)||r,r=(0,o.inject)("StocksRepositoryRequest")(u,void 0,0)||r))||r;var u;t.ListHistoricPricesUseCase=l},755:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListProjectGainsController=void 0;var r=s(757),o=s(178);t.ListProjectGainsController=class{async handle(e,t){const{stock_name:s}=e.params,{purchasedAmount:a,purchasedAt:n}=e.query,i=r.container.resolve(o.ListProjectGainsUseCase),c=await i.execute({stock_name:s,purchasedAmount:a,purchasedAt:n});return t.json(c)}}},178:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListProjectGainsUseCase=void 0,s(236);var r,o=s(757),a=s(703),n=s(174),i=s(729);let c=(0,o.injectable)()((l=r=Reflect.metadata("design:type",Function)(r=Reflect.metadata("design:paramtypes",[void 0===i.IStocksRepositoryRequest?Object:i.IStocksRepositoryRequest])(r=class{constructor(e){this.stocksRepositoryRequest=e,this.messageError="Thank you for using Alpha Vantage! Our standard API call frequency is 5 calls per minute and 500 calls per day. Please visit https://www.alphavantage.co/premium/ if you would like to target a higher API call frequency.",this.messageInvalidApi="Invalid API call. Please retry or visit the documentation (https://www.alphavantage.co/documentation/) for TIME_SERIES_DAILY."}async execute({stock_name:e,purchasedAmount:t,purchasedAt:s}){const r=await this.stocksRepositoryRequest.findByProjectGains(e,t,s);if(r.data["Error Message"])throw new a.AppError("Name invalid");const o={},i=r.data["Meta Data"],c=r.data["Time Series (Daily)"];if(r.data.Note)throw new a.AppError(this.messageError);if(null==c[s])throw new a.AppError("Date invalid");if(r.data["Error Message"])throw new a.AppError(this.messageInvalidApi);let l=i["2. Symbol"],u=Number(t),p=(0,n.convertAndParseFloat)(c[s]["4. close"]),d=i["3. Last Refreshed"];const[h,y]=d.split(" ");let v=(0,n.convertAndParseFloat)(c[h]["4. close"]),m=v*u-p*u;return Object.assign(o,{name:l,purchasedAmount:u,purchasedAt:s,priceAtDate:p,lastPrice:v,capitalGains:m}),o}})||r)||r,r=(0,o.inject)("StocksRepositoryRequest")(l,void 0,0)||r))||r;var l;t.ListProjectGainsUseCase=c},906:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListRecentQuotesController=void 0;var r=s(757),o=s(705);t.ListRecentQuotesController=class{async handle(e,t){const{stock_name:s}=e.params,a=r.container.resolve(o.ListRecentQuotesUseCase),n=await a.execute({stock_name:s});return t.json(n)}}},705:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ListRecentQuotesUseCase=void 0,s(236);var r,o=s(757),a=s(703),n=s(750),i=s(174),c=s(729);let l=(0,o.injectable)()((u=r=Reflect.metadata("design:type",Function)(r=Reflect.metadata("design:paramtypes",[void 0===c.IStocksRepositoryRequest?Object:c.IStocksRepositoryRequest])(r=class{constructor(e){this.stocksRepositoryRequest=e,this.messageError="Thank you for using Alpha Vantage! Our standard API call frequency is 5 calls per minute and 500 calls per day. Please visit https://www.alphavantage.co/premium/ if you would like to target a higher API call frequency."}async execute({stock_name:e}){const t=await this.stocksRepositoryRequest.findByRecentQuotes(e),s={},r=t.data["Global Quote"];if(t.data.Note)throw new a.AppError(this.messageError);let o=r["01. symbol"],c=(0,i.convertAndParseFloat)(r["05. price"]),l=(0,n.convertDateToUTC)(r["07. latest trading day"]);if(null!=o)return Object.assign(s,{name:o,lastPrice:c,pricedAt:l}),s;if(r)throw new a.AppError("Stock name invalid")}})||r)||r,r=(0,o.inject)("StocksRepositoryRequest")(u,void 0,0)||r))||r;var u;t.ListRecentQuotesUseCase=l},666:(e,t,s)=>{var r=s(757),o=s(663);r.container.registerSingleton("StocksRepositoryRequest",o.StocksRepositoryRequest)},703:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppError=void 0,t.AppError=class{constructor(e,t=400){this.message=void 0,this.statusCode=void 0,this.message=e,this.statusCode=t}}},877:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.app=void 0,s(236);var r=i(s(860)),o=i(s(582));s(383),s(666);var a=s(703),n=s(978);function i(e){return e&&e.__esModule?e:{default:e}}const c=(0,r.default)();t.app=c,c.use(r.default.json()),c.use(((e,t,s)=>{t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods",["GET","POST"]),c.use((0,o.default)()),s()})),c.use(n.router),c.use(((e,t,s,r)=>e instanceof a.AppError?s.status(e.statusCode).json({message:e.message}):s.status(500).json({status:"error",message:`Internal server error: ${e.message}`})))},978:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;var r=s(860),o=s(198);const a=(0,r.Router)();t.router=a,a.use("/stocks",o.stocksRouter)},198:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stocksRouter=void 0;var r=s(860),o=s(401),a=s(585),n=s(755),i=s(906);const c=(0,r.Router)();t.stocksRouter=c;const l=new i.ListRecentQuotesController,u=new a.ListHistoricPricesController,p=new o.ListCompareStocksController,d=new n.ListProjectGainsController;c.get("/:stock_name/quote",l.handle),c.get("/:stock_name/history",u.handle),c.get("/:stock_name/compare",p.handle),c.get("/:stock_name/gains",d.handle)},750:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertDateToUTC=t.convertDate=void 0,t.convertDate=e=>Date.parse(e),t.convertDateToUTC=e=>{let t=Date.parse(e),s=new Date(t),r=s.getFullYear().toString()+"-";return r+=(s.getMonth()+1).toString().padStart(2,"0")+"-",r+=(s.getDate()+1).toString().padStart(2,"0")+"T",r+=s.getHours().toString().padStart(2,"0")+":",r+=s.getMinutes().toString().padStart(2,"0")+":",r+=s.getSeconds().toString().padStart(2,"0")+"Z",r}},174:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertAndParseFloat=void 0,t.convertAndParseFloat=e=>Number(parseFloat(e).toFixed(2))},167:e=>{e.exports=require("axios")},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},383:e=>{e.exports=require("express-async-errors")},236:e=>{e.exports=require("reflect-metadata")},757:e=>{e.exports=require("tsyringe")}},t={};(function s(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,s),a.exports})(877).app.listen(3333,(()=>console.log("Server On")))})();